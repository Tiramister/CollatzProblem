# Collatz予想シミュレータ

本レポジトリは、「ハードウェア構成法2018」の課題で作成したコードを公開することを目的として作成された。


## VHDLディレクトリ

### 各種回路

| ファイル名 | 内容 |
| :---: | :--- |
| collatz\_[version].vhdl | 入力に整数を与えると、(入力・最高値・ステップ数)の組を返す。各バージョンの違いは後述。 |
| sorter.vhdl | 常にcollatzが返す型の値を4つ保持する。新しい入力が来ると、最高値が同じものがあればステップ数を大きい方に更新、なければ最高値について降順にソートする。|
| ram.vhdl | collatz_ramにて使用。collatzが返した値を全て保持する。[DOULOS社が公開しているコード](https://www.doulos.com/knowhow/vhdl_designers_guide/models/simple_ram_model/)を元にしている。 |
| top.vhdl | 上の4つを全てまとめ、1から1023までの入力について最高値が高い順に上から４つを返す。 |

### collatzの種類

`collatz_[version].vhdl`の`[version]`に、以下のバージョン名を入れたものが該当のソースファイル。ただし`collatz_tb.vhdl`は例外。

| バージョン名 | 内容 | クロック数 |
| :---: | :--- | :---: |
| simple | 偶数なら2で割る、奇数なら3倍して1引くを1ステップ/クロックで実行する。 | 65,400 |
| boost | バレルシフタによって、偶数のときに1クロック内で割れるだけ2で割ってしまう。 | 45,094 |
| ram | シミュレート中にramを参照して、探索済みの値になったらそこで終了して結果を返す。 | 9,301 |


### その他

| ファイル名 | 内容 |
| :---: | :--- |
| types.vhdl | 型を宣言。 |
| collatz_tb.vhdl | collatz系ファイルのテストベンチ。1から1023までの入力を流す。 |
| testbench.vhdl | top.vhdlのテストベンチ。クロックを流し込むだけ。 |

私の環境ではrecordをそのままでは波形出力できないため、テストベンチファイルでは出力をバラしている。

## Cディレクトリ

上で作成した回路の処理をC言語で模倣したもの。VHDLを見る前にこちらから見ると、何をしているかがわかりやすいかもしれない。

ばらつきが大きかったので、10回の平均を取っている。

| バージョン名 | 平均クロック数 |
| :---: | :---: |
| simple | 971K |
| boost | 1,860K |
| ram | 576K |
